/* ============ ROOT & BASE ============ */
:root{
  --primary-color:#1a73e8; --primary-light:#e8f0fe;
  --border-color:#e0e0e0; --text-color:#202124; --text-secondary:#5f6368;
  --background:#f8f9fa; --card-shadow:0 6px 18px rgba(0,0,0,.10);
  --sidebar-w: 340px;
  --taxon-media-w: 280px; /* larghezza condivisa img + box link */
}
*{box-sizing:border-box}
body{
  margin:0; font-family:'Segoe UI', Roboto,'Helvetica Neue',sans-serif;
  color:var(--text-color); background:var(--background); line-height:1.6;
}

/* ============ LAYOUT GRID ============ */
.record-container{
  display:grid; grid-template-columns:5fr 3fr; gap:2rem;
  align-items:stretch; max-width:1400px; margin:2rem auto 1rem; padding:0 2rem;
}
.macro-box{ display:flex; flex-direction:column; gap:.75rem; }

/* ============ TITOLI & CAMPI ============ */
h1{ color:var(--primary-color); margin:0 0 .5rem; font-size:1.8rem; }
h2{ color:var(--text-secondary); font-weight:400; font-size:1.2rem; margin:0 0 1.2rem; }
h3{ margin:.2rem 0 .6rem; font-size:1.1rem; color:#333; font-weight:700; }
.taxon-title{ font-size:1.25rem; letter-spacing:.2px; text-transform:lowercase; margin:0 0 .8rem; } /* più risalto */
.field{ margin:1rem 0; padding-bottom:1rem; border-bottom:1px solid var(--border-color); }
.field:last-child{ border-bottom:none; }
.label{ display:inline-block; min-width:160px; font-weight:600; color:var(--primary-color); }

/* ============ SUB-BOX (contenitori interni) ============ */
.subbox{
  border-radius:10px; padding:1rem 1.2rem; border:1px solid rgba(0,0,0,.12); background:#fff;
  box-shadow: var(--card-shadow); /* Ombra per TUTTI i box */
}

/* Colori specifici */
#sample-info{ background:#e6f4ea; border:1px solid #cfe8d2; }
#site-card  { background:#e8f0fe; border:1px solid #cddbf9; }
#context-card{background:#fde8e7; border:1px solid #f6c5c3; }

/* Spaziatura interna colonne */
#sample-info + #taxon-detail-box{ margin-top:.75rem; }
#site-card + #context-card{ margin-top:.75rem; }

/* ============ Ancora al fondo: Taxon detail & Context ============ */
#taxon-detail-box{ margin-top:auto; } /* spinge in basso nella colonna sinistra */
#context-card{ margin-top:auto; }     /* spinge in basso nella colonna destra */

/* ============ TAXON DETAIL (2 colonne ordinate) ============ */
#taxon-detail-box{
  background:rgba(92,91,47,.5);
  color:#f1f1e6;
  border:1px solid rgba(92,91,47,.8);
  border-radius:10px;
  padding:1rem 1.2rem;
  display:block; /* titolo a tutta larghezza */
}
#taxon-detail-box .label{ color:#e6e3c7; }

/* griglia interna a 2 colonne */
.taxon-grid{
  display:grid;
  grid-template-columns: 1.4fr 1fr; /* sinistra più larga */
  gap:1rem 1.25rem;
  align-items:start;
}

/* colonna sinistra */
.taxon-meta{ display:flex; flex-direction:column; gap:.6rem; }

/* Data sources */
.taxon-sources .label-inline{
  display:block;
  font-weight:700; color:#e6e3c7; margin:.2rem 0 .5rem;
}
.source-logos{
  display:flex; gap:1rem; align-items:center;
  margin:.35rem 0 .2rem;
}
.src-logo img{
  width:64px; height:64px; object-fit:contain;
  filter:drop-shadow(0 1px 1px rgba(0,0,0,.25));
}

/* Image source riga */
.image-source a{ color:#fffbcc; text-decoration:underline; }
.image-source a:hover{ opacity:.9; }

.image-source a.disabled{
  pointer-events:none;
  opacity:.65;
  text-decoration: none;
}

/* colonna destra: immagine + box link */
.taxon-media{ display:flex; flex-direction:column; gap:.75rem; align-items:center; }
#td-image{
  display:block; width:auto; max-width: var(--taxon-media-w); max-height:180px;
  object-fit:contain; border-radius:6px; margin:0 auto;
  background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15);
}
.taxon-links-panel{
  width:100%; max-width: var(--taxon-media-w); margin:0 auto;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.18);
  border-radius:8px;
  padding:.6rem;
}
.taxon-links-row{
  display:flex; flex-direction:column; gap:.5rem;
}
.link-btn{
  display:inline-block; padding:.45rem .75rem; border-radius:6px; font-size:.92rem;
  text-decoration:none; border:1px solid transparent; cursor:pointer;
  transition:background .2s,color .2s,opacity .2s; width:100%; text-align:center;
}
.link-btn.success{ background:#1e8e3e; color:#fff; border-color:#166e2c; }
.link-btn.success:hover{ background:#166e2c; }
.link-btn.danger{ background:#f3d7d4; color:#a50e0e; border-color:#e4b3ae; cursor:not-allowed; opacity:.85; }
.link-btn.disabled{ pointer-events:none; }

/* chip usi */
.chip{
  display:inline-block; background:rgba(255,255,255,.12); color:#f7f6e8;
  padding:.15rem .5rem; border-radius:999px; margin:0 .25rem .25rem 0;
  font-size:.85rem; border:1px solid rgba(255,255,255,.15);
}

/* SITE: griglia link in coppie + website full width */
#site-links{
  display:grid;
  grid-template-columns: 1fr 1fr;
  grid-template-areas:
    "wiki commons"
    "wikidata osm"
    "website website";
  gap:.6rem;
}
#site-links > a:nth-child(1){ grid-area: wiki; }
#site-links > a:nth-child(2){ grid-area: commons; }
#site-links > a:nth-child(3){ grid-area: wikidata; }
#site-links > a:nth-child(4){ grid-area: website; } /* Website a tutta riga */
#site-links > a:nth-child(5){ grid-area: osm; }

/* Responsive: impila sotto i 900px */
@media (max-width:900px){
  .taxon-grid{ grid-template-columns:1fr; }
  #td-image{ max-width:100%; }
  .taxon-links-panel{ max-width:100%; }
  #site-links{
    grid-template-columns: 1fr;
    grid-template-areas:
      "wiki"
      "commons"
      "wikidata"
      "osm"
      "website";
  }
}

/* ============ MAPPE ============ */
.mini-map{
  width:100%; height:260px; border:1px solid rgba(0,0,0,.3);
  border-radius:8px; overflow:hidden; background:#fff;
}
.province-map{
  width:100%; height:360px; border:1px solid var(--border-color);
  border-radius:8px; box-shadow:var(--card-shadow); margin-top:1rem;
}
.province-legend{
  margin-top:.5rem; font-size:.9rem; color:var(--text-secondary);
}
.province-legend .legend-bar{ display:flex; align-items:center; gap:.6rem; margin-top:.25rem; }
.province-legend .legend-bar .bar{
  flex:1; height:10px; background:linear-gradient(to right,#fff 0%,#f00 100%);
  border:1px solid #ddd; border-radius:6px;
}

/* ============ COLLAPSIBLE (related) ============ */
.collapsible{ margin-top:.5rem; border:1px solid var(--border-color); border-radius:8px; overflow:hidden; box-shadow:var(--card-shadow); }
.collapsible summary{
  padding:1rem; background:var(--primary-light); color:var(--primary-color); font-weight:600;
  cursor:pointer; list-style:none; display:flex; justify-content:space-between; align-items:center;
}
.collapsible summary::-webkit-details-marker{ display:none; }
.collapsible summary::after{ content:'+'; font-size:1.2rem; }
.collapsible[open] summary::after{ content:'-'; }
.collapsible-content{ padding:1.2rem; }

/* ============ RELATED SAMPLES ============ */
.related-box{
  margin:1.5rem auto 3rem; padding:1rem 2rem; max-width:1400px;
  background:#f2f3f5; border:1px solid #e0e0e0; border-radius:12px; box-shadow:var(--card-shadow);
}

/* Grid contenuti + sidebar collassabile */
.related-grid{
  display:grid; grid-template-columns: 1fr auto; gap:1rem;
  align-items:start;
}
.related-main{ min-width:0; } /* evita overflow griglia */

/* Sidebar: laterale e collassabile (display togglato dal JS) */
.affinity-sidebar{
  width: var(--sidebar-w);
  background:#fff;
  border:1px solid var(--border-color);
  border-radius:8px;
  box-shadow:var(--card-shadow);
  overflow:hidden;
}
.affinity-sidebar-inner{ padding:1rem; }
.sidebar-title{ margin:0 0 .75rem; font-size:1rem; color:#333; font-weight:700; }

/* Griglia oggetti */
.object-list{
  display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:1rem; margin-top:1rem;
}
.object-card{
  display:flex; flex-direction:column; gap:.35rem; border:1px solid var(--border-color);
  border-radius:8px; padding:1rem; background:#fff; transition:transform .2s, box-shadow .2s; box-shadow:var(--card-shadow);
}
.object-card:hover{ transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,.1); }
.affinity-badge{
  display:inline-block; padding:.25rem .5rem; background:var(--primary-light);
  color:var(--primary-color); border-radius:12px; font-size:.75rem; font-weight:600; margin-top:.25rem;
}

/* ============ AFFINITY CONTROLS / SLIDERS ============ */
.affinity-controls{ display:flex; gap:1rem; margin-top:.5rem; align-items:center; flex-wrap:wrap; }
.affinity-range{ display:flex; gap:.5rem; align-items:center; }
.affinity-range input{ width:80px; padding:.4rem; border:1px solid var(--border-color); border-radius:4px; }
.view-toggle{ display:flex; gap:.5rem; align-items:center; }
.toggle-btn{
  background:#f1f3f4; color:#3c4043; border:1px solid #dadce0; padding:.35rem .6rem;
  border-radius:6px; cursor:pointer; font-size:.85rem;
}
.toggle-btn.active{ background:var(--primary-light); color:var(--primary-color); border-color:var(--primary-color); }
.show-more-btn{
  background:var(--primary-color); color:#fff; border:0; padding:.55rem 1rem; border-radius:6px;
  cursor:pointer; font-size:.9rem; margin-top:1rem; transition:background .2s;
}
.show-more-btn:hover{ background:#0d5bbc; }

.slider-container{ margin-bottom:.9rem; }
.slider-container label{ display:block; margin-bottom:.4rem; font-weight:500; }
.slider-container input[type="range"]{
  width:100%; height:6px; border-radius:3px; background:var(--border-color); appearance:none;
}
.slider-container input[type="range"]::-webkit-slider-thumb{
  appearance:none; width:18px; height:18px; border-radius:50%; background:var(--primary-color); cursor:pointer;
}
.affinity-actions{ display:flex; gap:.5rem; margin-top:.6rem; }
.apply-btn{
  background:var(--primary-color); color:#fff; border:0; padding:.6rem 1.1rem; border-radius:6px; cursor:pointer; font-weight:500;
}
.apply-btn:hover{ background:#0d5bbc; }
.apply-btn.outline{ background:#fff; color:#1a73e8; border:1px solid #1a73e8; }
.apply-btn.outline:hover{ background:#e8f0fe; }
.settings-toggle{
  display:inline-flex; align-items:center; gap:.4rem; padding:.4rem .8rem; font-size:.85rem;
  background:var(--primary-light); border:none; border-radius:4px; color:var(--primary-color); font-weight:500; cursor:pointer;
}
.settings-toggle:hover{ background:var(--primary-color); color:#fff; }

/* ============ RESPONSIVE ============ */
@media (max-width:1180px){
  .related-grid{ grid-template-columns: 1fr minmax(0, var(--sidebar-w)); }
}
@media (max-width:1024px){
  .record-container{ grid-template-columns:1fr; }
}
@media (max-width:800px){
  .related-grid{ grid-template-columns:1fr; }
  .affinity-sidebar{ width:100%; }
}

/* ============ TUTORIAL (compatto) ============ */
.tutorial-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:9998; transition:opacity .3s; }
.tutorial-highlight{
  position:fixed; background:rgba(255,255,255,.3); border:2px solid #3498db; border-radius:8px;
  z-index:9999; transition:all .3s; pointer-events:none; opacity:0;
}
.tutorial-highlight::after{
  content:""; position:absolute; width:20px; height:20px; background:#3498db; transform:rotate(45deg); z-index:10000;
}
.tutorial-highlight.arrow-right::after{ top:50%; right:-10px; margin-top:-10px; }
.tutorial-highlight.arrow-left::after { top:50%; left:-10px;  margin-top:-10px; }
.tutorial-highlight.arrow-top::after  { top:-10px; left:50%;  margin-left:-10px; }
.tutorial-highlight.arrow-bottom::after{ bottom:-10px; left:50%; margin-left:-10px; }
.tutorial-box{
  position:fixed; background:#fff; border-radius:12px; padding:25px; max-width:400px;
  box-shadow:0 5px 20px rgba(0,0,0,.3); z-index:10000; transition:opacity .3s;
}
.tutorial-title{ color:#2c3e50; font-size:1.4rem; margin:0 0 15px; font-family:"Playfair Display",serif; }
.tutorial-content{ color:#34495e; margin-bottom:20px; line-height:1.5; }
.tutorial-image{ max-width:100%; height:auto; margin-bottom:20px; border-radius:8px; display:none; }
.tutorial-nav{ display:flex; justify-content:space-between; align-items:center; }
.tutorial-button{ padding:8px 15px; border:0; border-radius:6px; font-weight:600; cursor:pointer; transition:all .2s; }
.tutorial-prev{ background:#f8f9fa; color:#7f8c8d; } .tutorial-prev:hover{ background:#e9ecef; }
.tutorial-next{ background:#3498db; color:#fff; }  .tutorial-next:hover{ background:#2980b9; }
.tutorial-close{ background:#e74c3c; color:#fff; margin-left:auto; } .tutorial-close:hover{ background:#c0392b; }

/* ============ MINI-MAP (leaflet) ============ */
#mini-map {
  width: 100%;
  height: 280px;
  border: 2px solid #ccc;
  border-radius: 8px;
  background: #f8f9fa;
  position: relative;
}
#mini-map:empty::before {
  content: "Loading map...";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #666;
  font-style: italic;
}
.leaflet-interactive { stroke-width: 2px !important; }
.leaflet-marker-icon { filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5)); }

/* Controlli aggregazione heatmap province */
.prov-controls{
  margin-top: .5rem;
  margin-bottom: .25rem;
  display: flex;
  justify-content: flex-end;
}
.prov-controls .view-toggle{
  display: flex;
  gap: .5rem;
  align-items: center;
}

